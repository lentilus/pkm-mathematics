\documentclass{article}
\usepackage[subpreambles=false]{standalone}
\usepackage{import}
\usepackage{luacode}
\usepackage{hyperref}

\title{Xettelkasten Glossary}
\author{Lentilus}
\date{\today}
\input{standalone_preamble.tex}    

\begin{luacode}
    require 'lfs'
  
    function references(zettel)
        local file = io.open(zettel.."/references", "r")
        if file:lines() ~= nil then
            tex.print("\\begin{enumerate}")
        end
        for line in file:lines() do
            tex.print("\\item \\hyperlink{"..line.."}{"..line.."}")
        end
        if file:lines() ~= nil then
            tex.print("\\end{enumerate}")
        end
        file:close()
        -- this is necessary
        collectgarbage("collect")
    end

  function include_files_recursively(directory)
   for file in lfs.dir(directory) do
      if file ~= "." and file ~= ".." then
        local path = directory .. '/' .. file
        local attr = lfs.attributes(path)
        if attr.mode == "directory" then
           include_files_recursively(path)
        elseif string.match(file, "zettel.tex") then
           tex.print("\\input{" .. path .. "}")
        end
      end
   end
  end
\end{luacode}

\renewenvironment{zettel}[1]{%
    \hypertarget{#1}{\section*{#1}}
    \def\temp{#1}
}{%
    \expandafter\directlua\expandafter{references("\temp")}
    \newpage
}%

\begin{document}

\maketitle

\begin{mdframed}
   This file is the compiled pdf of Lentilus' Zettelkasten.

   This pdf will get autcompiled using LuaLatex on Gitlab.com.

   For an up-to-date version please check (url).

   Each zettel (section) contains an atomic idea/concept/definition.

   %...
\end{mdframed}
\newpage

% \directlua{include_all("./*/zettel.tex")}
\directlua{include_files_recursively(".")}

\end{document}
